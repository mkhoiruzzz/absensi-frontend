{"ast":null,"code":"// src/pages/Capture.js\nimport React,{useState,useEffect}from\"react\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Capture(_ref){let{currentUser,onSuccess}=_ref;const[status,setStatus]=useState(\"\");const[keterangan,setKeterangan]=useState(\"\");const[foto,setFoto]=useState(\"\");const[userLocation,setUserLocation]=useState(null);const[error,setError]=useState(null);const[sending,setSending]=useState(false);useEffect(()=>{if(!navigator.geolocation){setError(\"Geolocation tidak didukung browser Anda\");return;}navigator.geolocation.getCurrentPosition(pos=>setUserLocation({latitude:pos.coords.latitude,longitude:pos.coords.longitude}),()=>setError(\"Harap aktifkan lokasi untuk capture absensi\"));},[]);const handleFotoChange=e=>{const file=e.target.files[0];if(!file)return;const reader=new FileReader();reader.onloadend=()=>setFoto(reader.result);reader.readAsDataURL(file);};const handleSubmit=async e=>{e.preventDefault();if(!status)return alert(\"Status wajib diisi\");if(!userLocation)return alert(\"Lokasi belum tersedia\");if(!(currentUser!==null&&currentUser!==void 0&&currentUser.id))return alert(\"User tidak terdeteksi, silakan login kembali\");const payload={user_id:currentUser.id,status,keterangan:keterangan||\"-\",foto,latitude:userLocation.latitude,longitude:userLocation.longitude};try{setSending(true);const res=await fetch(\"http://localhost:5000/absensi\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(payload)});const data=await res.json();if(res.ok){alert(\"Absensi berhasil dikirim!\");onSuccess(payload);// update UI\nsetStatus(\"\");setKeterangan(\"\");setFoto(\"\");}else{alert(\"Gagal: \"+(data.error||\"Server error\"));}}catch(err){console.error(err);alert(\"Terjadi kesalahan saat mengirim absensi.\");}finally{setSending(false);}};if(error)return/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:error});if(!userLocation)return/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:\"Meminta izin lokasi...\"});return/*#__PURE__*/_jsxs(\"div\",{className:\"card\",style:{maxWidth:720,margin:\"20px auto\"},children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Absen \",currentUser===null||currentUser===void 0?void 0:currentUser.name]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Status:\"}),/*#__PURE__*/_jsxs(\"select\",{value:status,onChange:e=>setStatus(e.target.value),required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Pilih status\"}),/*#__PURE__*/_jsx(\"option\",{value:\"hadir\",children:\"Hadir\"}),/*#__PURE__*/_jsx(\"option\",{value:\"izin\",children:\"Izin\"}),/*#__PURE__*/_jsx(\"option\",{value:\"sakit\",children:\"Sakit\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Keterangan (opsional):\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:keterangan,onChange:e=>setKeterangan(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Foto (opsional):\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:handleFotoChange})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:sending,children:sending?\"Mengirim...\":\"Kirim Absensi\"})]}),foto&&/*#__PURE__*/_jsx(\"div\",{style:{marginTop:12},children:/*#__PURE__*/_jsx(\"img\",{src:foto,alt:\"Preview\",style:{width:\"100%\",borderRadius:6}})}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:12},children:[/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Lokasi:\"})}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Latitude: \",userLocation.latitude]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Longitude: \",userLocation.longitude]})]})]});}","map":{"version":3,"names":["React","useState","useEffect","jsx","_jsx","jsxs","_jsxs","Capture","_ref","currentUser","onSuccess","status","setStatus","keterangan","setKeterangan","foto","setFoto","userLocation","setUserLocation","error","setError","sending","setSending","navigator","geolocation","getCurrentPosition","pos","latitude","coords","longitude","handleFotoChange","e","file","target","files","reader","FileReader","onloadend","result","readAsDataURL","handleSubmit","preventDefault","alert","id","payload","user_id","res","fetch","method","headers","body","JSON","stringify","data","json","ok","err","console","className","children","style","maxWidth","margin","name","onSubmit","value","onChange","required","type","accept","disabled","marginTop","src","alt","width","borderRadius"],"sources":["C:/laragon1/www/sistem-absensi/src/pages/Capture.js"],"sourcesContent":["// src/pages/Capture.js\r\nimport React, { useState, useEffect } from \"react\";\r\n\r\nexport default function Capture({ currentUser, onSuccess }) {\r\n  const [status, setStatus] = useState(\"\");\r\n  const [keterangan, setKeterangan] = useState(\"\");\r\n  const [foto, setFoto] = useState(\"\");\r\n  const [userLocation, setUserLocation] = useState(null);\r\n  const [error, setError] = useState(null);\r\n  const [sending, setSending] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!navigator.geolocation) {\r\n      setError(\"Geolocation tidak didukung browser Anda\");\r\n      return;\r\n    }\r\n    navigator.geolocation.getCurrentPosition(\r\n      (pos) =>\r\n        setUserLocation({\r\n          latitude: pos.coords.latitude,\r\n          longitude: pos.coords.longitude,\r\n        }),\r\n      () => setError(\"Harap aktifkan lokasi untuk capture absensi\")\r\n    );\r\n  }, []);\r\n\r\n  const handleFotoChange = (e) => {\r\n    const file = e.target.files[0];\r\n    if (!file) return;\r\n    const reader = new FileReader();\r\n    reader.onloadend = () => setFoto(reader.result);\r\n    reader.readAsDataURL(file);\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!status) return alert(\"Status wajib diisi\");\r\n    if (!userLocation) return alert(\"Lokasi belum tersedia\");\r\n    if (!currentUser?.id) return alert(\"User tidak terdeteksi, silakan login kembali\");\r\n\r\n    const payload = {\r\n      user_id: currentUser.id,\r\n      status,\r\n      keterangan: keterangan || \"-\",\r\n      foto,\r\n      latitude: userLocation.latitude,\r\n      longitude: userLocation.longitude,\r\n    };\r\n\r\n    try {\r\n      setSending(true);\r\n      const res = await fetch(\"http://localhost:5000/absensi\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(payload),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (res.ok) {\r\n        alert(\"Absensi berhasil dikirim!\");\r\n        onSuccess(payload); // update UI\r\n        setStatus(\"\");\r\n        setKeterangan(\"\");\r\n        setFoto(\"\");\r\n      } else {\r\n        alert(\"Gagal: \" + (data.error || \"Server error\"));\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert(\"Terjadi kesalahan saat mengirim absensi.\");\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n\r\n  if (error) return <div className=\"card\">{error}</div>;\r\n  if (!userLocation) return <div className=\"card\">Meminta izin lokasi...</div>;\r\n\r\n  return (\r\n    <div className=\"card\" style={{ maxWidth: 720, margin: \"20px auto\" }}>\r\n      <h2>Absen {currentUser?.name}</h2>\r\n      <form onSubmit={handleSubmit}>\r\n        <div className=\"form-group\">\r\n          <label>Status:</label>\r\n          <select value={status} onChange={(e) => setStatus(e.target.value)} required>\r\n            <option value=\"\">Pilih status</option>\r\n            <option value=\"hadir\">Hadir</option>\r\n            <option value=\"izin\">Izin</option>\r\n            <option value=\"sakit\">Sakit</option>\r\n          </select>\r\n        </div>\r\n\r\n        <div className=\"form-group\">\r\n          <label>Keterangan (opsional):</label>\r\n          <input type=\"text\" value={keterangan} onChange={(e) => setKeterangan(e.target.value)} />\r\n        </div>\r\n\r\n        <div className=\"form-group\">\r\n          <label>Foto (opsional):</label>\r\n          <input type=\"file\" accept=\"image/*\" onChange={handleFotoChange} />\r\n        </div>\r\n\r\n        <button type=\"submit\" disabled={sending}>{sending ? \"Mengirim...\" : \"Kirim Absensi\"}</button>\r\n      </form>\r\n\r\n      {foto && <div style={{ marginTop: 12 }}><img src={foto} alt=\"Preview\" style={{ width: \"100%\", borderRadius: 6 }} /></div>}\r\n\r\n      <div style={{ marginTop: 12 }}>\r\n        <p><strong>Lokasi:</strong></p>\r\n        <p>Latitude: {userLocation.latitude}</p>\r\n        <p>Longitude: {userLocation.longitude}</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}